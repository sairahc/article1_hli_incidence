---
title: "Grid plot of best fit flexible models"
subtitle: "Association between HLI and common cancer incidence in NOWAC"
author: "Sairah L.F. Chen"
date: "11/12/2020"
output: pdf_document

# document is for generating an image to be published in the main article
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rms)
library(survival)
library(tidyverse)
library(ggpubr)
library(cowplot)


casesIncluded <- read.csv2(file="../data/casesIncluded25112020.csv")
```

```{r best fit plots , echo=FALSE, warning=FALSE}

ddist <- datadist(casesIncluded)
options(datadist="ddist")


# breast, 3 knots
coxspline3Breast <- cph(Surv(ageMenopause, ageExit, statusBreast) ~ rcs(HLIScore, 3) + 
                          education +
                          HRTStatus +
                          OCEverUse +
                          parityCat +
                          familyHistBC +
                          ageMenarche +
                          breastfeedingCat, data=casesIncluded, x=TRUE, y=TRUE)



plotBreast3 <- ggplot(rms:::Predict(coxspline3Breast, HLIScore=seq(1, 20),
                                        fun=exp),
                            xlab= "HLI Score",
                          ylab="HR",
                      adj.subtitle = FALSE) + 
  ggtitle("Breast cancer") +
  theme(legend.position = "none")

plotBreast3

#crc, 3 knots

coxspline3Colorectal <- cph(Surv(ageEntry, ageExit, statusColorectal) ~ rcs(HLIScore, 3) + education, data=casesIncluded, x=TRUE, y=TRUE)

plotColorectal3 <- ggplot(rms:::Predict(coxspline3Colorectal, HLIScore=seq(1, 20),
                                        fun=exp),
                            xlab= "HLI Score",
                          ylab="HR",
                          adj.subtitle = FALSE) + 
  ggtitle("Colorectal cancer")

plotColorectal3

#lung, 5 knots


coxspline5Lung <- cph(Surv(ageEntry, ageExit, statusLung) ~ rcs(HLIScore, 5) + 
                        education, data=casesIncluded, x=TRUE, y=TRUE)
plotLung5 <- ggplot(rms:::Predict(coxspline5Lung, HLIScore=seq(1, 20),
                   fun=exp),
       xlab= "HLI Score",
     ylab="HR",
     adj.subtitle = FALSE) + 
  ggtitle("Lung cancer")

plotLung5


# endometrial, 3 knots
coxspline3Endometrial <- cph(Surv(ageMenopause, ageExit, statusEndometrial) ~ rcs(HLIScore, 3) + 
                          education +
                          HRTStatus +
                          OCEverUse +
                          parityCat +
                          ageMenarche +
                          breastfeedingCat, data=casesIncluded, x=TRUE, y=TRUE)

plotEndometrial3 <- ggplot(rms:::Predict(coxspline3Endometrial, HLIScore=seq(1, 20),
                                    fun=exp),
                        xlab= "HLI Score",
                      ylab="HR",
                      adj.subtitle = FALSE) + 
  ggtitle("Endometrial cancer")

plotEndometrial3


# ovarian, 3 knots
coxspline3Ovarian <- cph(Surv(ageMenopause, ageExit, statusOvarian) ~ rcs(HLIScore, 3) + 
                          education +
                          HRTStatus +
                          OCEverUse +
                          parityCat +
                          ageMenarche +
                          breastfeedingCat, data=casesIncluded, x=TRUE, y=TRUE)

plotOvarian3 <- ggplot(rms:::Predict(coxspline3Ovarian, HLIScore=seq(1, 20),
                                    fun=exp),
                        xlab= "HLI Score",
                      ylab="HR",
                      adj.subtitle = FALSE) + 
  ggtitle("Ovarian cancer")

plotOvarian3 

# pancreatic, 3 knots
coxspline3Pancreatic <- cph(Surv(ageEntry, ageExit, statusPancreatic) ~ rcs(HLIScore, 3) + education, data=casesIncluded, x=TRUE, y=TRUE)

plotPancreatic3 <- ggplot(rms:::Predict(coxspline3Pancreatic, HLIScore=seq(1, 20),
                                    fun=exp),
                        xlab= "HLI Score",
                      ylab="HR",
                      adj.subtitle = FALSE) + 
  ggtitle("Pancreatic cancer")

plotPancreatic3

# kidney, 3 knots

coxspline3Kidney <- cph(Surv(ageEntry, ageExit, statusKidney) ~ rcs(HLIScore, 3) + education, data=casesIncluded, x=TRUE, y=TRUE)

plotKidney3 <- ggplot(rms:::Predict(coxspline3Kidney, HLIScore=seq(1, 20),
                                        fun=exp),
                            xlab= "HLI Score",
                          ylab="HR",
                      adj.subtitle = FALSE) + 
  ggtitle("Kidney cancer")

plotKidney3


flexiblePlot <- plot_grid(plotBreast3, #need to label with a,b,c etc
             plotColorectal3, 
             plotLung5,
             plotEndometrial3,
             plotOvarian3,
             plotPancreatic3,
             plotKidney3,
             ncol=3, nrow=3) 
# save to png
png("C:/Users/sch044/OneDrive - UiT Office 365/R/Paper1_new/output/flexible_bestfit_plot.png", width= 1600, height = 1600)
print(flexiblePlot)
dev.off()

flexiblePlot

```






